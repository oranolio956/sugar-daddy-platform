apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

metadata:
  name: dandy-babe-production

resources:
  - ../../kubernetes/namespace.yaml
  - ../../kubernetes/configmaps/app-config.yaml
  - ../../kubernetes/secrets/app-secrets.yaml
  - ../../kubernetes/services/
  - ../../kubernetes/deployments/

configMapGenerator:
  - name: app-config-production
    literals:
      - NODE_ENV=production
      - LOG_LEVEL=warn
      - CORS_ORIGIN=https://dandybabe.com,https://www.dandybabe.com
      - RATE_LIMIT_WINDOW=15
      - RATE_LIMIT_MAX=100
      - SESSION_TIMEOUT=86400000
      - PASSWORD_RESET_EXPIRY=3600000
      - EMAIL_VERIFICATION_EXPIRY=86400000
      - MATCH_EXPIRY_HOURS=24
      - MAX_UPLOAD_SIZE=5242880
      - ALLOWED_FILE_TYPES=image/jpeg,image/png,image/gif
      - CACHE_TTL_DEFAULT=300
      - CACHE_TTL_USER_PROFILE=900
      - CACHE_TTL_MATCH_RESULTS=300
      - CACHE_TTL_SEARCH_RESULTS=120

secretGenerator:
  - name: app-secrets-production
    literals:
      - jwt-secret=production-jwt-secret-key-change-in-production
      - db-username=production_user
      - db-password=production_password
      - db-host=postgres-production
      - db-name=sugar_daddy_production
      - redis-password=production_redis_password
      - redis-host=redis-production
      - smtp-host=smtp.gmail.com
      - smtp-port=587
      - smtp-user=production-email@dandybabe.com
      - smtp-password=production-app-password
      - smtp-from=noreply@dandybabe.com
      - stripe-secret-key=sk_live_production_stripe_key
      - stripe-publishable-key=pk_live_production_stripe_key
      - paypal-client-id=production_paypal_client_id
      - paypal-client-secret=production_paypal_client_secret
      - aws-access-key-id=production_aws_access_key_id
      - aws-secret-access-key=production_aws_secret_access_key
      - aws-region=us-east-1
      - s3-bucket-name=dandy-babe-production-uploads
      - grafana-password=production_grafana_password
      - prometheus-retention=720h
      - encryption-key=production-32-character-encryption-key
      - two-factor-secret=production-two-factor-secret-key

patchesStrategicMerge:
  - deployment-patches.yaml

images:
  - name: ghcr.io/dandy-babe-platform/api-gateway
    newTag: latest
  - name: ghcr.io/dandy-babe-platform/user-service
    newTag: latest
  - name: ghcr.io/dandy-babe-platform/matching-service
    newTag: latest
  - name: ghcr.io/dandy-babe-platform/messaging-service
    newTag: latest
  - name: ghcr.io/dandy-babe-platform/payment-service
    newTag: latest
  - name: ghcr.io/dandy-babe-platform/notification-service
    newTag: latest
  - name: ghcr.io/dandy-babe-platform/frontend
    newTag: latest